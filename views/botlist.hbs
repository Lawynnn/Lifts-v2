<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your bots â€“ li</title>

    {{!-- Personal Scripts --}}
    <script src="/javascript/dash2.js"></script>
    <script src="/javascript/_loadingscreen.js"></script>

    {{!-- Stylesheet --}}
    <link rel="stylesheet" href="/stylesheets/style_2.0.css">

    {{!-- Boxicons --}}
    <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>

    {{!-- jQuery --}}
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    {{!-- Moment --}}
    <script src="https://momentjs.com/downloads/moment.min.js"></script>
</head>
<body>
    <div class="loading-screen">
        <img id="loading-img" src="/images/2025_logo.png" />
        <div class="loader">
            <div class="inner-loader"></div>
        </div>
    </div>
    <div class="nav">
        <div class="header">
            <h4>Kargo</h4>
        </div>
        <div class="footer">
            <div class="col">
                <span>Hey, <strong>{{user.username}}</strong></span>
                <span style="font-size: 14px">{{#if user.rank}}{{user.rank}}{{else}}Member{{/if}}</span>
            </div>
            <img src="https://cdn.discordapp.com/avatars/{{user.id}}/{{user.avatar}}.png">
        </div>
    </div>
    <div class="container">
        <div class="content">
            <div class="botlist" id="bots-container">
                <div class="options-container" style="
                    background: #2d2d344a;
                    border-radius: 15px;
                    width: 332px;
                    height: 250px;
                    padding: 15px;
                    margin: 10px;
                ">
                                    <div class="options" style="
                    display: flex;
                    flex-direction: column;
                    align-items: baseline;
                    background: #2d2d34;
                    /* height: 25%; */
                    padding: 20px;
                    border-radius: 15px;
                    justify-content: space-between;
                ">
                                        <button class="btn" style="
                    color: var(--g-txt-sec);
                    margin-left: 15px;
                    margin-bottom: 5px;
                "><box-icon color="var(--g-txt-sec)" name="plus" style="
                    margin: 0;
                    vertical-align: middle;
                    margin-right: 5px;
                "></box-icon> Add bot</button>
                                    <button class="btn" style="
                    color: var(--g-txt-sec);
                    margin-left: 15px;
                "><box-icon color="var(--g-txt-sec)" name="refresh" style="
                    margin: 0;
                    vertical-align: middle;
                    margin-right: 5px;
                "></box-icon> Refresh bots</button></div>
                                    
                </div>
            </div>
        </div>
        
    </div>
</body>
</html>

<script>
$(window).ready(async () => {
    const getBots = async () => {
        let bots = await $.get("/api/v1/bot", (data) => data);
        console.log(bots);
        return bots;
    }

    let bots = await getBots();
    let ls = new _LoadingScreen(bots.bots.length);
    bots.bots.map((bot, index) => {
        $("#bots-container").append(`
        <a href="/dashboard/${bot._id}" class="btn bot" data-id="${bot._id}">
            <div class="header">
                <img src="${bot.data.avatar}">
                <div class="title">
                    <h5>${bot.data.username}</h5>
                    <span>${bot.data.id}</span>
                </div>
            </div>
            <div class="sep horizontal"></div>
            <div class="footer">
                <span class="title">Statistics</span>
                <div class="statistics">
                    <div class="row">
                        <span><box-icon color="#ffffff" name='code-curly'></box-icon> Commands</span>
                        <span class="count">${bot.commands.length}</span>
                    </div>
                    <div class="row">
                        <span><box-icon color="#ffffff" name='data'></box-icon> Variables</span>
                        <span class="count">${bot.variables.length}</span>
                    </div>
                    <div class="row">
                        <span><box-icon color="#ffffff" name='stats'></box-icon> Status</span>
                        <div style="background: ${bot.online ? "var(--g-active)" : "var(--g-inactive)"};" class="stats-view"></div>
                    </div>
                    <br>
                    <div class="row">
                        <span><box-icon color="#ffffff" name='time'></box-icon> Created at</span>
                        <span data-date="${bot.createdAt}">Loading...</span>
                    </div>
                    <div class="row">
                        <span><box-icon color="#ffffff" name='up-arrow-circle'></box-icon> Last update</span>
                        <span data-date-cut="true" data-date="${bot.updatedAt}">Loading...</span>
                    </div>
                </div>
            </div>
        </a>
        `)
    })

    $("*").filter((index, elem) => $(elem).data("date")).each((index, elem) => {
        ls.addStep();
        elem = $(elem);
        let date = new Date(elem.data("date"));
        if(elem.data("date-cut")) {
            elem.html(moment(date).startOf("second").fromNow());
            return;
        }
        elem.html(moment(date).format("Do MMM[.] YYYY [at] HH:MM"));
        
    })
    
})
</script>